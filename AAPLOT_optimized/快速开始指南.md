# 🚀 AAPlot 修改版代码快速开始指南

## 📋 准备工作

### 1. 安装依赖
```bash
# 安装Python包
pip install pandas numpy matplotlib seaborn scipy PyYAML
```

### 2. 准备数据文件
确保您的数据文件格式正确：
- **多文件分析**: 文件夹中包含多个 `.txt` 文件，每个文件三列（时间、信号、事件标记）
- **荧光分析**: 单个 `.csv` 文件，三列（时间、信号、事件标记）

## 🎯 使用方法

### 方法1: 运行脚本（推荐新手）

#### 多文件数据分析
```bash
# 1. 编辑 run_multi_file_analysis.py 中的文件夹路径
# 2. 运行脚本
python run_multi_file_analysis.py
```

#### 荧光信号分析
```bash
# 1. 编辑 run_fluorescence_analysis.py 中的文件路径
# 2. 运行脚本
python run_fluorescence_analysis.py
```

### 方法2: 命令行使用（推荐熟练用户）

#### 荧光分析命令行
```bash
# 基本使用
python optimized_fluorescence_analyzer.py your_data.csv

# 自定义参数
python optimized_fluorescence_analyzer.py your_data.csv --pre-event 30 --post-event 150 --output-dir ./results
```

### 方法3: 配置文件使用（推荐批量处理）

```bash
# 1. 编辑 config.yaml 中的参数
# 2. 运行配置文件版本
python run_with_config.py
```

## 📁 文件说明

| 文件名 | 用途 | 替换原文件 |
|--------|------|------------|
| `optimized_aplot_notebook.py` | 多文件数据分析核心 | Jupyter notebook |
| `optimized_fluorescence_analyzer.py` | 荧光信号分析核心 | `AAPlot_Event_dFF0.py` |
| `run_multi_file_analysis.py` | 多文件分析运行脚本 | - |
| `run_fluorescence_analysis.py` | 荧光分析运行脚本 | - |
| `run_with_config.py` | 配置文件版本 | - |
| `config.yaml` | 配置文件 | - |
| `requirements.txt` | 依赖包列表 | - |

## ⚙️ 参数配置

### 多文件分析参数
```python
config = PlotConfig()
config.folder_path = "your_data_folder"  # 数据文件夹
config.pre_event_time = 0.5              # 事件前时间(小时)
config.post_event_time = 2.0             # 事件后时间(小时)
config.x_limits = (-0.25, 1.5)           # X轴范围
config.y_limits = (-5, 15)               # Y轴范围
```

### 荧光分析参数
```python
config = AnalysisConfig()
config.pre_event_time = 20.0             # 事件前时间(秒)
config.post_event_time = 120.0           # 事件后时间(秒)
config.baseline_start_time = 100.0       # 基线开始时间
config.baseline_end_time = 500.0         # 基线结束时间
config.output_dir = './output'           # 输出目录
```

## 📊 输出文件

### 多文件分析输出
- `optimized_plot.svg` - 主图表
- `optimized_metrics.csv` - 统计指标
- `optimized_aligned_data.csv` - 对齐后的数据

### 荧光分析输出
- `merged_dff0_traces.csv` - 合并的dF/F0轨迹
- `merged_zscore_traces.csv` - 合并的z-score轨迹
- `fluorescent_dF/F0_plot.png` - dF/F0图表
- `fluorescent_z-score_plot.png` - z-score图表

## 🔧 常见问题

### Q1: 如何修改数据文件夹路径？
**A**: 在运行脚本中修改 `config.folder_path` 变量，或在 `config.yaml` 中修改 `data.folder_path`

### Q2: 如何处理不同格式的数据文件？
**A**: 修改 `load_data_files()` 方法中的文件读取部分，或使用pandas的其他读取函数

### Q3: 如何调整图表样式？
**A**: 修改 `PlotConfig` 中的颜色、字体、轴范围等参数

### Q4: 如何处理大量数据文件？
**A**: 使用配置文件版本，可以批量处理多个文件夹

### Q5: 如何添加新的统计指标？
**A**: 在 `MetricsCalculator.calculate_metrics()` 方法中添加新的计算逻辑

## 🆚 与原版对比

| 功能 | 原版 | 修改版 |
|------|------|--------|
| 易用性 | 需要手动修改代码 | 配置文件+命令行参数 |
| 错误处理 | 基本无 | 完整的异常处理 |
| 代码结构 | 混合在notebook中 | 模块化设计 |
| 性能 | 较慢 | 优化后更快 |
| 扩展性 | 困难 | 易于扩展 |

## 📞 技术支持

如果遇到问题，请检查：
1. 依赖包是否正确安装
2. 数据文件格式是否正确
3. 文件路径是否存在
4. 参数设置是否合理

查看详细日志信息来定位具体问题。
